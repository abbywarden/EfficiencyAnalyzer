#ifndef PROTOTYPE_H
#define PROTOTYPE_H
#include <iostream>
#include <fstream>
#include <sstream>
#include "TH2Poly.h"
#include "TCanvas.h"
#include "TColor.h"
#include "TROOT.h"
#include "TStyle.h"
#include "TH2Poly.h"
#include "TGraphAsymmErrors.h"


struct VFAT_hits
    {
    int vfat;
    int matchedHits;
    int propagatedHits;
    
    VFAT_hits(int i, int m, int p): vfat(i), matchedHits(m), propagatedHits(p) {}
    };
std::string chamberName(int station, int region, int chamber, int layer);
void SetPalette();

std::string TH1_output_name;
std::string TH2_output_name;
std::string line,word;
std::vector<std::string> row;
std::vector<std::vector<std::string>> content;    
std::map<std::string,std::vector<VFAT_hits>> EfficiencyCollector;



namespace GE11Geometry{
std::map<char,const std::vector< std::array<Double_t, 4>>> MapShort = {
    {'x',{{{-3.83938562003834,-4.14080692494689,-12.4513908518566,-11.5450181214881}},
          {{-4.14080692494689,-4.44222822985544,-13.3577635822252,-12.4513908518566}},
          {{-4.44222822985544,-4.79536310569235,-14.4196388259069,-13.3577635822252}},
          {{-4.79536310569235,-5.14849798152926,-15.4815140695887,-14.4196388259069}},
          {{-5.14849798152926,-5.56365370199756,-16.7298857598484,-15.4815140695887}},
          {{-5.56365370199756,-5.97880942246586,-17.9782574501081,-16.7298857598484}},
          {{-5.97880942246586,-6.47069378786385,-19.4573518871341,-17.9782574501081}},
          {{-6.47069378786385,-6.96257815326184,-20.9364463241602,-19.4573518871341}},
          {{-3.83938562003834,-4.14080692494689,4.14080692494689,3.83938562003834}},
          {{-4.14080692494689,-4.44222822985544,4.44222822985544,4.14080692494689}},
          {{-4.44222822985544,-4.79536310569235,4.79536310569235,4.44222822985544}},
          {{-4.79536310569235,-5.14849798152926,5.14849798152926,4.79536310569235}},
          {{-5.14849798152926,-5.56365370199756,5.56365370199756,5.14849798152926}},
          {{-5.56365370199756,-5.97880942246586,5.97880942246586,5.56365370199756}},
          {{-5.97880942246586,-6.47069378786385,6.47069378786385,5.97880942246586}},
          {{-6.47069378786385,-6.96257815326184,6.96257815326184,6.47069378786385}},
          {{3.83938562003834,4.14080692494689,12.4513908518566,11.5450181214881}},
          {{4.14080692494689,4.44222822985544,13.3577635822252,12.4513908518566}},
          {{4.44222822985544,4.79536310569235,14.4196388259069,13.3577635822252}},
          {{4.79536310569235,5.14849798152926,15.4815140695887,14.4196388259069}},
          {{5.14849798152926,5.56365370199756,16.7298857598484,15.4815140695887}},
          {{5.56365370199756,5.97880942246586,17.9782574501081,16.7298857598484}},
          {{5.97880942246586,6.47069378786385,19.4573518871341,17.9782574501081}},
          {{6.47069378786385,6.96257815326184,20.9364463241602,19.4573518871341}}}
    },
    {'y',{{{0,10.206,10.206,0}},
          {{10.206,20.412,20.412,10.206}},
          {{20.412,32.369,32.369,20.412}},
          {{32.369,44.326,44.326,32.369}},
          {{44.326,58.383,58.383,44.326}},
          {{58.383,72.44,72.44,58.383}},
          {{72.4399999999999,89.0949999999999,89.0949999999999,72.4399999999999}},
          {{89.0949999999999,105.75,105.75,89.0949999999999}},
          {{0,10.206,10.206,0}},
          {{10.206,20.412,20.412,10.206}},
          {{20.412,32.369,32.369,20.412}},
          {{32.369,44.326,44.326,32.369}},
          {{44.326,58.383,58.383,44.326}},
          {{58.383,72.44,72.44,58.383}},
          {{72.4399999999999,89.0949999999999,89.0949999999999,72.4399999999999}},
          {{89.0949999999999,105.75,105.75,89.0949999999999}},
          {{0,10.206,10.206,0}},
          {{10.206,20.412,20.412,10.206}},
          {{20.412,32.369,32.369,20.412}},
          {{32.369,44.326,44.326,32.369}},
          {{44.326,58.383,58.383,44.326}},
          {{58.383,72.44,72.44,58.383}},
          {{72.4399999999999,89.0949999999999,89.0949999999999,72.4399999999999}},
          {{89.0949999999999,105.75,105.75,89.0949999999999}}}
    }
};

std::map<char, std::vector<std::array<Double_t, 4>> > MapLong = {
    {'y',{{{0,11.307,11.307,0}},
          {{11.307,22.614,22.614,11.307}},
          {{22.614,36.07,36.07,22.614}},
          {{36.07,49.526,49.526,36.07}},
          {{49.526,65.633,65.633,49.526}},
          {{65.633,81.74,81.74,65.633}},
          {{81.74,101.145,101.145,81.74}},
          {{101.145,120.55,120.55,101.145}},
          {{0,11.307,11.307,0}},
          {{11.307,22.614,22.614,11.307}},
          {{22.614,36.07,36.07,22.614}},
          {{36.07,49.526,49.526,36.07}},
          {{49.526,65.633,65.633,49.526}},
          {{65.633,81.74,81.74,65.633}},
          {{81.74,101.145,101.145,81.74}},
          {{101.145,120.55,120.55,101.145}},
          {{0,11.307,11.307,0}},
          {{11.307,22.614,22.614,11.307}},
          {{22.614,36.07,36.07,22.614}},
          {{36.07,49.526,49.526,36.07}},
          {{49.526,65.633,65.633,49.526}},
          {{65.633,81.74,81.74,65.633}},
          {{81.74,101.145,101.145,81.74}},
          {{101.145,120.55,120.55,101.145}}}
    },
    {'x', {{{-3.83938562003834,-4.17332356777506,-12.5491682745625,-11.5450181214881}},
           {{-4.17332356777506,-4.50726151551178,-13.5533184276368,-12.5491682745625}},
           {{-4.50726151551178,-4.90466746092129,-14.7483166110425,-13.5533184276368}},
           {{-4.90466746092129,-5.30207340633079,-15.9433147944483,-14.7483166110425}},
           {{-5.30207340633079,-5.77777328465355,-17.3737425397006,-15.9433147944483}},
           {{-5.77777328465355,-6.2534731629763,-18.804170284953,-17.3737425397006}},
           {{-6.2534731629763,-6.82657530110586,-20.5274862591644,-18.804170284953}},
           {{-6.82657530110586,-7.39967743923543,-22.2508022333757,-20.5274862591644}},
           {{-3.83938562003834,-4.17332356777506,4.17332356777506,3.83938562003834}},
           {{-4.17332356777506,-4.50726151551178,4.50726151551178,4.17332356777506}},
           {{-4.50726151551178,-4.90466746092129,4.90466746092129,4.50726151551178}},
           {{-4.90466746092129,-5.30207340633079,5.30207340633079,4.90466746092129}},
           {{-5.30207340633079,-5.77777328465355,5.77777328465355,5.30207340633079}},
           {{-5.77777328465355,-6.2534731629763,6.2534731629763,5.77777328465355}},
           {{-6.2534731629763,-6.82657530110586,6.82657530110586,6.2534731629763}},
           {{-6.82657530110586,-7.39967743923543,7.39967743923543,6.82657530110586}},
           {{3.83938562003834,4.17332356777506,12.5491682745625,11.5450181214881}},
           {{4.17332356777506,4.50726151551178,13.5533184276368,12.5491682745625}},
           {{4.50726151551178,4.90466746092129,14.7483166110425,13.5533184276368}},
           {{4.90466746092129,5.30207340633079,15.9433147944483,14.7483166110425}},
           {{5.30207340633079,5.77777328465355,17.3737425397006,15.9433147944483}},
           {{5.77777328465355,6.2534731629763,18.804170284953,17.3737425397006}},
           {{6.2534731629763,6.82657530110586,20.5274862591644,18.804170284953}},
           {{6.82657530110586,7.39967743923543,22.2508022333757,20.5274862591644}}}
    }
    };

//Additional dumb polygons to standardize Axis ranges
const std::array<Double_t, 4> shape_x = {-120.55/2,-120.55/2,120.55/2,120.55/2};
const std::array<Double_t, 4> shape_y = {125.,125.01,125.01,125.};
}

namespace GE11VfatPlot{
TCanvas *c = new TCanvas("c1","c1",1080,1080); 
TH1I *numerator = new TH1I("num","num",24,-0.5,23.5);
TH1I *denominator = new TH1I("den","den",24,-0.5,23.5);

TH2Poly* GetTH2PolyShort(){
    TH2Poly *TH2Short = new TH2Poly();
    for(int vfat = 0; vfat < 24; vfat++){
        int currentBin = TH2Short->AddBin(4,GE11Geometry::MapShort['x'][vfat].data(),GE11Geometry::MapShort['y'][vfat].data());
        TH2Short->SetBinContent(currentBin,0);
    }
    TH2Short->AddBin(4,GE11Geometry::shape_x.data(),GE11Geometry::shape_y.data());
	TH2Short->SetStats(false);
	TH2Short->SetMaximum(1.0);
	TH2Short->SetMinimum(0.);
    return TH2Short;
    }

TH2Poly* GetTH2PolyLong(){
    TH2Poly *TH2Long = new TH2Poly();
    for(int vfat = 0; vfat < 24; vfat++){
        int currentBin = TH2Long->AddBin(4,GE11Geometry::MapLong['x'][vfat].data(),GE11Geometry::MapLong['y'][vfat].data());
        TH2Long->SetBinContent(currentBin,0);
    }
    TH2Long->AddBin(4,GE11Geometry::shape_x.data(),GE11Geometry::shape_y.data());  
	TH2Long->SetStats(false);
	TH2Long->SetMaximum(1.0);
	TH2Long->SetMinimum(0.);
    return TH2Long;
    }

TGraphAsymmErrors* GetTH1Plot(){
    TGraphAsymmErrors* TH1Plot = new TGraphAsymmErrors();
    TH1Plot->GetXaxis()->SetTitle("VFAT");
    TH1Plot->GetXaxis()->SetLabelSize(0.03);
    TH1Plot->GetYaxis()->SetTitle("Efficiency");
    TH1Plot->GetYaxis()->SetLabelSize(0.03);
    TH1Plot->SetMinimum(0);
    TH1Plot->SetLineColor(kBlack);
    TH1Plot->SetMarkerColor(kRed);
    TH1Plot->SetFillColorAlpha(kBlack,.4);
    TH1Plot->SetMarkerStyle(20);
    TH1Plot->SetMarkerSize(.8);
    TH1Plot->SetMaximum(1.1);
    TH1Plot->SetMinimum(0);
    return TH1Plot; 
    }
}

#endif

/*                    
TODO Implement geometry for GE21 to
VFATGeometryDict['M1'][0]['y'] = {1.169866747,0,19.54564441,20.88280085}
VFATGeometryDict['M1'][2]['y'] = {1.896834552,1.195217265,20.91177647,21.71372427}
VFATGeometryDict['M1'][4]['y'] = {2.14399835,1.90963383,21.72835384,21.99623223}
VFATGeometryDict['M1'][6]['y'] = {1.903188493,2.143934715,21.9961595,21.72098682}
VFATGeometryDict['M1'][8]['y'] = {1.179493036,1.892922135,21.70925239,20.89380369}
VFATGeometryDict['M1'][10]['y'] = {0,1.174478088,20.88807161,19.54564441}
VFATGeometryDict['M1'][1]['y'] = {20.88280085,19.54564441,39.11050342,40.61511401}
VFATGeometryDict['M1'][3]['y'] = {21.71372427,20.91177647,40.64771828,41.55009524}
VFATGeometryDict['M1'][5]['y'] = {21.99623223,21.72835384,41.56655689,41.8679821}
VFATGeometryDict['M1'][7]['y'] = {21.72098682,21.9961595,41.86790026,41.55826729}
VFATGeometryDict['M1'][9]['y'] = {20.89380369,21.70925239,41.54506333,40.62749475}
VFATGeometryDict['M1'][11]['y'] = {19.54564441,20.88807161,40.62104483,39.11050342}
VFATGeometryDict['M1'][0]['x'] = {-16.41719437,-24.30425159,-27.77973354,-18.76483558}
VFATGeometryDict['M1'][2]['x'] = {-8.280420166,-16.20291029,-18.5199091,-9.46451138}
VFATGeometryDict['M1'][4]['x'] = {0.003242604,-8.063357167,-9.216408604,0.003706293}
VFATGeometryDict['M1'][6]['x'] = {8.17338673,0.132962837,	0.15197638,9.342172277}
VFATGeometryDict['M1'][8]['x'] = {16.33616046,8.345640395,	9.539058032,18.67221391}
VFATGeometryDict['M1'][10]['x'] = {24.30425159,16.37842693,	18.72052443,27.77973354}
VFATGeometryDict['M1'][1]['x'] = {-18.76483558,-27.77973354,-31.2586321,-21.11478466}
VFATGeometryDict['M1'][3]['x'] = {-9.46451138,-18.5199091,	-20.83918567,-10.64976663}
VFATGeometryDict['M1'][5]['x'] = {0.003706293,-9.216408604,-10.37059356,0.004170437}
VFATGeometryDict['M1'][7]['x'] = {9.342172277,0.15197638,0.171008615,10.51210681}
VFATGeometryDict['M1'][9]['x'] = {18.67221391,9.539058032,	10.73364887,21.01056384}
VFATGeometryDict['M1'][11]['x'] = {27.77973354,18.72052443,	21.06492437,31.2586321}
VFATGeometryDict['M2'][0]['y'] = {44.19831414,42.66329547,62.20895491,63.91126339}
VFATGeometryDict['M2'][2]['y'] = {45.15219128,44.23157734,63.9481517,64.96909623}
VFATGeometryDict['M2'][4]['y'] = {45.47650261,45.16898561,64.98772085,65.32875175}
VFATGeometryDict['M2'][6]['y'] = {45.16052848,45.47641911,65.32865915,64.97834205}
VFATGeometryDict['M2'][8]['y'] = {44.21094509,45.14705767,64.96340316,63.9252709}
VFATGeometryDict['M2'][10]['y'] = {42.66329547,44.20436482,63.9179735,62.20895491}
VFATGeometryDict['M2'][1]['y'] = {63.91126339,62.20895491,81.77378387,83.64354625}
VFATGeometryDict['M2'][3]['y'] = {64.96909623,63.9481517,83.68406321,84.80543674}
VFATGeometryDict['M2'][5]['y'] = {65.32875175,64.98772085,84.82589343,85.20047111}
VFATGeometryDict['M2'][7]['y'] = {64.97834205,65.32865915,85.2003694,84.81559205}
VFATGeometryDict['M2'][9]['y'] = {63.9252709,64.96340316,84.79918364,83.65893165}
VFATGeometryDict['M2'][11]['y'] = {62.20895491,63.9179735,83.65091641,81.77378387}
VFATGeometryDict['M2'][0]['x'] = {-21.54151303,-31.89036694,-35.36585156,-23.88915605}
VFATGeometryDict['M2'][2]['x'] = {-10.86499769,-21.26034421,-23.57734481,-12.04908982}
VFATGeometryDict['M2'][4]['x'] = {0.004254722,-10.58018256,-11.73323488,0.004718411}
VFATGeometryDict['M2'][6]['x'] = {10.72455578,0.174464687,0.193478245,11.89334223}
VFATGeometryDict['M2'][8]['x'] = {21.43518592,10.95057519,12.14399375,23.77124116}
VFATGeometryDict['M2'][10]['x'] = {31.89036694,21.49064507,23.83274437,35.36585156}
VFATGeometryDict['M2'][1]['x'] = {-23.88915605,-35.36585156,-38.84474477,-26.23910153}
VFATGeometryDict['M2'][3]['x'] = {-12.04908982,-23.57734481,-25.89661781,-13.23434325}
VFATGeometryDict['M2'][5]['x'] = {0.004718411,-11.73323488,-12.88741807,0.005182555}
VFATGeometryDict['M2'][7]['x'] = {11.89334223,0.193478245,0.212510451,13.06327497}
VFATGeometryDict['M2'][9]['x'] = {23.77124116,12.14399375,13.33858275,26.1095875}
VFATGeometryDict['M2'][11]['x'] = {35.36585156,23.83274437,26.17714071,38.84474477}
VFATGeometryDict['M3'][0]['y'] = {87.22674637,85.32657592,108.9263495,111.0285087}
VFATGeometryDict['M3'][2]['y'] = {88.40753277,87.26792226,111.0740616,112.334813}
VFATGeometryDict['M3'][4]['y'] = {88.80899161,88.42832216,112.3578123,112.7789471}
VFATGeometryDict['M3'][6]['y'] = {88.41785324,88.80888825,112.7788327,112.3462306}
VFATGeometryDict['M3'][8]['y'] = {87.24238199,88.40117798,112.3277827,111.0458064}
VFATGeometryDict['M3'][10]['y'] = {85.32657592,87.2342364,111.0367949,108.9263495}
VFATGeometryDict['M3'][1]['y'] = {111.0285087,108.9263495,132.5453077,134.8496197}
VFATGeometryDict['M3'][3]['y'] = {112.334813,111.0740616,134.8995532,136.281544}
VFATGeometryDict['M3'][5]['y'] = {112.7789471,112.3578123,136.3067551,136.768388}
VFATGeometryDict['M3'][7]['y'] = {112.3462306,112.7788327,136.7682626,136.2940595}
VFATGeometryDict['M3'][9]['y'] = {111.0458064,112.3277827,136.2738377,134.8685808}
VFATGeometryDict['M3'][11]['y'] = {108.9263495,111.0367949,134.8587028,132.5453077}
VFATGeometryDict['M3'][0]['x'] = {-26.6658299,-39.47647962,-43.67284098,-29.50041544}
VFATGeometryDict['M3'][2]['x'] = {-13.44957431,-26.31777635,-29.1153637,-14.87926801}
VFATGeometryDict['M3'][4]['x'] = {0.005266839,-13.09700706,-14.48922276,0.005826706}
VFATGeometryDict['M3'][6]['x'] = {13.27572394,0.215966523,0.238923828,14.68693729}
VFATGeometryDict['M3'][8]['x'] = {26.53420958,13.55550907,14.99646366,29.35480384}
VFATGeometryDict['M3'][10]['x'] = {39.47647962,26.60286141,29.43075338,43.67284098}
VFATGeometryDict['M3'][1]['x'] = {-29.50041544,-43.67284098,-47.87261363,-32.33730525}
VFATGeometryDict['M3'][3]['x'] = {-14.87926801,-29.1153637,-31.91522524,-16.31012392}
VFATGeometryDict['M3'][5]['x'] = {0.005826706,-14.48922276,-15.8825702,0.006387027}
VFATGeometryDict['M3'][7]['x'] = {14.68693729,0.238923828,0.261899795,16.09929783}
VFATGeometryDict['M3'][9]['x'] = {29.35480384,14.99646366,16.43858962,32.17769101}
VFATGeometryDict['M3'][11]['x'] = {43.67284098,29.43075338,32.26094418,47.87261363}
VFATGeometryDict['M4'][0]['y'] = {138.4328199,136.0980998,159.6978884,162.2345973}
VFATGeometryDict['M4'][2]['y'] = {139.8836401,138.4834123,162.2895667,163.8109356}
VFATGeometryDict['M4'][4]['y'] = {140.3769085,139.9091838,163.8386892,164.3468792}
VFATGeometryDict['M4'][6]['y'] = {139.8963207,140.3767815,164.3467412,163.8247133}
VFATGeometryDict['M4'][8]['y'] = {138.4520312,139.875832,163.802452,162.2554707}
VFATGeometryDict['M4'][10]['y'] = {136.0980998,138.4420228,162.2445964,159.6978884}
VFATGeometryDict['M4'][1]['y'] = {162.2345973,159.6978884,183.3168166,186.0556781}
VFATGeometryDict['M4'][3]['y'] = {163.8109356,162.2895667,186.115028,187.7576361}
VFATGeometryDict['M4'][5]['y'] = {164.3468792,163.8386892,187.7876015,188.3362896}
VFATGeometryDict['M4'][7]['y'] = {163.8247133,164.3467412,188.3361406,187.7725118}
VFATGeometryDict['M4'][9]['y'] = {162.2554707,163.802452,187.7484765,186.0782149}
VFATGeometryDict['M4'][11]['y'] = {159.6978884,162.2445964,186.066474,183.3168166}
VFATGeometryDict['M4'][0]['x'] = {-32.76403362,-48.50434847,-52.70071251,-35.59862097}
VFATGeometryDict['M4'][2]['x'] = {-16.52535498,-32.33638377,-35.1339729,-17.95504959}
VFATGeometryDict['M4'][4]['x'] = {0.006471311,-16.0921592,-17.48437578,0.007031178}
VFATGeometryDict['M4'][6]['x'] = {16.3117468,0.265355868,0.288313187,17.72296105}
VFATGeometryDict['M4'][8]['x'] = {32.60231308,16.65551594,18.09647145,35.42290914}
VFATGeometryDict['M4'][10]['x'] = {48.50434847,32.68666488,35.51455865,52.70071251}
VFATGeometryDict['M4'][1]['x'] = {-35.59862097,-52.70071251,-56.90047981,-38.43550717}
VFATGeometryDict['M4'][3]['x'] = {-17.95504959,-35.1339729,-37.93383088,-19.38590368}
VFATGeometryDict['M4'][5]['x'] = {0.007031178,-17.48437578,-18.87772145,0.007591499}
VFATGeometryDict['M4'][7]['x'] = {17.72296105,0.288313187,0.311289125,19.13531979}
VFATGeometryDict['M4'][9]['x'] = {35.42290914,18.09647145,19.53859558,38.24579271}
VFATGeometryDict['M4'][11]['x'] = {52.70071251,35.51455865,38.34474586,56.90047981}
*/
